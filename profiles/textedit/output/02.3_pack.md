# 2.3 PACK — Tracing real operations through the sandbox

## A. Scenarios

- Open an existing document in ~/Documents via the open panel (user-selected path).
- Create a new document in the TextEdit container and autosave iterations.
- Open or save a document on an external volume/network share (outside home/container).
- Print a document from TextEdit.
- Access fonts/dictionaries during document rendering (system/library reads).
- Optional: save to or open from iCloud ubiquity container.

## B. Trace artefacts

- No traces present under `profiles/textedit/traces/` yet.
- Planned: fs_usage capture for “open existing document in ~/Documents” → `traces/fs_usage_open-documents.txt`.
- Planned: opensnoop capture for the same scenario → `traces/opensnoop_open-documents.txt`.
- Planned: fs_usage or sandbox-aware trace for container autosave → `traces/fs_usage_container-autosave.txt`.
- Planned: fs_usage/opensnoop for print scenario → `traces/print_document_fs_usage.txt` and `traces/print_document_opensnoop.txt`.
- Planned: ubiquity/iCloud save trace once available → `traces/ubiquity_save_fs_usage.txt`.

## C. Rule mappings (SBPL vs traces)

- Container autosave traces should show file-read*/file-write* under `~/Library/Containers/com.apple.TextEdit/Data/...` matching appsandbox-container-common/macos rules and application_darwin_cache/temp dir allowances.
- Open existing document from ~/Documents should exhibit sandbox extension issuance (scopedbookmarksagent mach-lookup) followed by allowed file-read*/file-write* on user-selected paths per user-selected file entitlements.
- External volume/network share accesses require the same user-selected extension path; expect open/read/write events paired with extension tokens rather than raw container access.
- Print scenario traces should align with (printing) macro allowances and IPC to DiscRecording registrar/PDF Services, without hitting denied sockets like localhost:631.
- Font/dictionary loads should map to read-only file-read* rules for /System/Library/Fonts, /Library/Fonts, /Library/Dictionaries, and ColorSync profile paths.
- iCloud save/load traces should hit ubiquity-filter "com.apple.TextEdit" paths, consistent with ubiquity read/write/link allowances.
- IPC seen in traces (e.g., tccd, pboxd, quicklook) should correspond to mach-lookup allowlist entries in the specialized SBPL.

## D. Notes for the writer

- Traces are currently placeholders; emphasize expected patterns and map them to SBPL rules until real captures land.
- Scenarios that best illustrate policy: user-selected open (shows extensions + outside-container access), container autosave (pure container flow), and print (macro-based IPC/filesystem mix).
- Consider explaining how mach-lookup events (tccd, quicklook, pboxd) in traces tie back to the large allowlist in the profile.
- Ubiquity scenario remains optional; note it for later linkage once iCloud traces are captured.
- Orientation/Concepts can help frame how sandbox extensions and container macros mediate the observed syscalls.***
