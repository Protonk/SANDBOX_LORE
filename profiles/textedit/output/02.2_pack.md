# 2.2 PACK — Profiles, containers, and entitlements in practice

## A. Structural summary (profile + container)

- Container root noted as ~/Library/Containers/com.apple.TextEdit/Data; primary read/write zone.
- appsandbox-container-common/macos macros active; application_container/application_darwin_* params supply container, cache, temp, and user dir paths for RW access and mounts.
- application_bundle_id and application_container_id parameters set to com.apple.TextEdit; used to allow mach-register for the bundle name and to permit reads of managed prefs and App Store support paths under /Library.
- DYLD path handling present (application_dyld_paths param): allows file-read*/process-exec on dyld_subpaths and issues extensions for those paths.
- Application bundle path allowed for read-directory-contents and exec when application_bundle param is set.
- Application Scripts directory for the container id allowed (read-only issuance + exec) under ~/Library/Application Scripts/com.apple.TextEdit.
- Read/write directory contents allowed for application_darwin_cache_dir and application_darwin_temp_dir with file-mount/unmount permitted there; tmpdir macro covers sandbox tmp.
- Ubiquity filter rules target com.apple.TextEdit container with read/write/link and extension issuance within the iCloud container namespace.

## B. Entitlement-to-structure mapping

- com.apple.security.app-sandbox = true → activates application.sb base profile and container macros (appsandbox-container-common/macos) wiring the container root and application_darwin_* paths.
- com.apple.security.files.user-selected.read-write/executable → triggers scopedbookmarksagent mach-lookup allowance and sandbox extension issuance for outside-container file access.
- com.apple.developer.ubiquity-container-identifiers = ["com.apple.TextEdit"] → drives ubiquity-filter "com.apple.TextEdit" rules enabling link/read/write and extensions in the iCloud container.
- com.apple.security.print = true → enables (printing) macro plus DiscRecording/PDF Services allowances embedded in profile structure.
- com.apple.application-identifier/com.apple.TextEdit → binds application_bundle_id/container_id params, enabling bundle-specific mach-register entries and managed preference/App Store support path allowances.
- com.apple.private.hid.client.event-dispatch.internal → retains HID-related allowances (IOHIDParamUserClient, event prefs) within the profile’s device/IPC sections.

## C. Key flows and invariants

- Default writes confined to the app container (Data, caches, temp) via container macros; these remain writable regardless of external file entitlements.
- System paths (/System, /bin, /usr*) stay read/exec only; /Library mostly read-only with explicit denies for caches/logs/managed prefs, preserving a read-only invariant for system resources.
- Outside-container document access hinges on user-selected file entitlements: requires UI-mediated selection → scoped bookmark → sandbox extension issuance before read/write/exec on external paths.
- iCloud storage flows through ubiquity-filter "com.apple.TextEdit": profile permits link/read/write inside that namespace, keeping cloud sync within the designated container.
- Application bundle and scripts paths are readable/executable for resource loading and helpers, but do not grant broader write outside the container.
- Key caches/temp dirs are writable and mountable (application_darwin_cache_dir/temp_dir/tmpdir), supporting autosave/scratch without breaking container boundaries.

## D. Notes for the writer

- Tool join is minimal (container_subdirs empty); real container layout may be richer—could mention this as a placeholder for future enumeration.
- Good teaching moment: one entitlement (user-selected files) fan-outs into mach-lookup to scopedbookmarksagent plus extension issuance, illustrating entitlement→macro plumbing.
- Orientation/Concepts tie-in: container params (application_darwin_* and application_container_id) show how the profile is parameterized per app; Appendix has SBPL macro explanations.
- Consider flagging how DYLD path allowances use params to keep framework loading constrained while still executable.
- Future work noted in planning file: auto-annotate container paths and link to traces in Section 2.3 for open/save flows.***
